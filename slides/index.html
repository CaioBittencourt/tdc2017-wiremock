<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>TDC 2017 - WireMock</title>

	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/hpe.css">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="lib/css/zenburn.css">
</head>

<body>
	<div class="reveal">
		<div class="slides">

			<section data-background="css/theme/images/cover-image-01.jpg">
				<img style="width: 300px" src="css/theme/images/hpe-logo.png">
				<h1 style="color:white;">WireMock: Criação de um ambiente confiável e escalável para execução de testes de integração</h1>
				<h2 style="color:white;">Luiz Hermes Svoboda Junior</h2>
				<h2 style="color:white;">Gustavo Coelho</h2>
				<p style="color:white;">
					<small>November, 2017</small>
				</p>
			</section>

			<section data-markdown>
				<script type="text/template">
					### Some background ...
					- Brief overview of what we do
					- How our CI environment looks like
					- What issues we have and how can we fix them
				</script>
			</section>

			<section>
				<h3>OneView Global Dashboard</h3>
				<div>
					<div style="float:left; width:50%;">
						<img src="css/theme/images/ovgd.png" style="border:2px solid black">
					</div>
					<div style="float:left; width:50%;">
						<ul style="font-size:25px">
							<li>Helps IT staff troubleshoot alerts and view core inventory data across multiple HPE management systems</li>
							<li>Provides an enhanced infrastructure view for more informed and faster decision-making</li>
							<li>Smart search function that delivers access to devices of interest across data centers in seconds</li>
							<li>Aggregates critical activates from multiple appliances into a single feed to quickly identify issues</li>
							<li>Customizable inventory and compliance report for monitored assets</li>
						</ul>
					</div>
				</div>
			</section>

			<section data-markdown>
				<script type="text/template">
					### How our CI environment looks like
					- xxx
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
					### Issues we have and how can we fix them
					- Apresentar o problema com o ambiente
					- Falhas recorrentes de builds causadas por problemas de infra Criação do CM para “manutenção” da infraestrutura (não resolveu o problema)
					- Incluir diagrama mostrando como é utilizado Utilização de pacote XYZ (talvez seja superserver) para mockar testes de REST dentro do próprio teste
					- Incluir um exemplo mostrando como fica o código
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
					### Automated Testing Stability and Team Confidence
					<img src="images/testing-vs-confidence.png" width="60%">
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
					### Integration Testing
					Desired characteristics
					- Stability Test must be reliable!
					- Speed I want to know as quickly as possible that I broke something!
					
					Important aspects to ensure test stability
					- Environment-agnostic tests: tests should be independent and self-contained
					- Test data: tests failing because expected data was not available in the system
					
					Speed
					- Depending on external components can be slow (ex. requests sent to OneView)
				</script>
			</section>

			<section class="breakslide">
				<h1>WireMock</h1>
				<h2>Mock your APIs for fast, robust and comprehensive testing</h2>
			</section>

			<section>
				<h2>
					WireMock
				</h2>
				<ul>
					<li>Simulator for HTTP-based APIs</li>
					<li>Supports testing of edge cases and failure modes that the real API won't reliably produce</li>
					<ul>
						<li>We can even extend current API limitation: extend OneView scale limits</li>
					</ul>
					<li>Ability to inject faulty behavior (delay injection and faulty responses)</li>
					<li>Because it’s fast it can reduce build time</li>
					<li>Run within a Java application or as a standalone process (embedded Jetty)</li>
					<li>Request Matching and Response Templating</li>
					<ul>
						<li>Match request URLs, methods, headers and bodies</li>
					</ul>
					<li>Record and Playback</li>
					<ul>
						<li>Get up and running quickly by capturing traffic to and from an existing API</li>
						<li>Playback using captured traffic data</li>
					</ul>
				</ul>
			</section>

			<section class="breakslide">
				<h1>"Talk is cheap. Show me the code."</h1>
				<h2>Linus Torvalds</h2>
			</section>

			<section class="breakslide">
				<h1>WireMock Demo</h1>
				<img src="images/demo.jpg">
			</section>

			<!-- Iniciar a demo com o trabalho desenvolvido rodando o WireMock Exemplo bobinho rodando o WireMock para graver requisição contra
			o Google Deixar um exemplo mais “completo” com falhas etc pronto e só rodar o WireMock apontando para ele A aplicação
			que vamos usar nesse caso é o CURL SEM FRESCURAS AQUI!!!! -->
			<section data-markdown>
				<script type="text/template">
					### WireMock Record and Playback
					- Web interface (http://localhost:8080/__admin/recorder)
					- Java API
					- WireMock REST API

					Allow customizing what to be recorded
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
					### Mocking GitHub API
					- Use case: developing an app to get statistics of a GH repository
						- Mocked a few APIs (summary info, issues and commits)
						- Mocked error situations
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
					### Mocking GitHub API
					- Start WireMock recorder UI pointing to https://api.github.com
						- Watch out for internal proxies! (--proxy-via)
					- Send requests using curl (or any other app)
					- Stop recorder, mocks saved
					- Start playback, develop your app
					- Enhance mocks capturing new ones or hand writing your owns
				</script>
			</section>

			<section class="breakslide">
				<h1>WireMock resultados obtidos</h1>
				<h2>Destacar os itens que colocamos na submissão como resultados desse trabalho</h2>
			</section>

			<section>
				<h2>
					<strong>falando sobre WireMock</strong>
				</h2>
				<ul>
					<li>Exemplificar menor numero de recursos</li>
					<ul>
						<li>Pegar uma foto dos numeros do ambiente real</li>
						<li>Cenário com OneView ou com HC380?</li>
						<ul>
							<li>Entendemos que com OneView os números seriam melhores mas não é o ambiente que temos – rodar com ambos indicando que
								com o OneView temos o desafio do RabbitMQ?</li>
						</ul>
						<li>RESULTADOS</li>
					</ul>
				</ul>
				ADICIONAR O QUE MAIS ACHARMOS RELEVANTE
			</section>

			<section class="breakslide">
				<h1>WireMock DEMO OVGD</h1>
				Iniciar a demo com o trabalho desenvolvido rodando o WireMock Serviços do GD rodando (já startados pois UI pode demorar)
				Mostrar um exemplo dos nossos testes e que não há referência para wiremock Exibir a estrutura de pastas e confguração
				do wiremock Abrir a UI do GD e iniciar a execução Ouvintes podem ver coisas acontecendo no GD Mostrar os logs console
				do wiremock Destacar que a aplicação, teste e configuração do ambiente de testes (wiremock) estão no git  portanto tudo
				versionado e principalmente reproduzível
			</section>

			<section>
				<h2>
					<strong>trabalhos futuros</strong>
				</h2>
				<ul>
					<li>Incluir aqui questão sobre como rodar os mocks: Containers estáticos VS dinâmicos (criados no momento do teste)</li>
					<li>Mock de outros protocolos: Exemplo: SCMB do Oneview</li>
					<li>Consistência de UUID: Como gerar randomizção e garantir consistência de identificadores</li>
					<li>Injeção de falhas</li>
				</ul>
				ADICIONAR O QUE MAIS ACHARMOS RELEVANTE
			</section>

			<section>
				<h2>
					<strong>Integration Testing Environment Approaches</strong>
				</h2>
				Set of “permanent” containers
				<ul>
					<li>Set of containers pre-configured (as many as needed)</li>
					<li>Each container with a set of configurations</li>
					<ul>
						<li>OneView with storage test requirements</li>
						<li>OneView with SPP bundle test requirements</li>
						<li>HC380 (Phoenix)</li>
						<li>HC380 (Hellfire)</li>
					</ul>
					<li>Real/Simulated appliances can also be available</li>
				</ul>
			</section>

			<section>
				<h2>
					<strong>Integration Testing Environment Approaches</strong>
				</h2>
				Container on-demand
				<ul>
					<li>Tests have their Wiremock files “embedded”</li>
					<li>Containers are created/started dinamically before the test execution</li>
					<li>Real/Simulated appliances can also be available</li>
				</ul>
			</section>

			<section>
				<h2>
					<strong>Pending issues</strong>
				</h2>
				<ul>
					<li>(OneView) SCMB / MSMB</li>
					<ul>
						<li>Install RabbitMQ (rabbitmq-server) in the Docker container</li>
					</ul>
				</ul>
				<ul>
					<li>(HC380) WebSocket</li>
					<ul>
						<li>mock-socket: Javascript mocking library for websockets and socket.io</li>
					</ul>
				</ul>
			</section>

			<section data-markdown>
				<script type="text/template">
					## References

					- [Slides / Sample code](https://github.com/gcoelho/tdc2017-wiremock)
					- [WireMock](http://wiremock.org/)
				</script>
			</section>

			<section>
				<h2>Thanks!!</h2>
				<table>
					<tr>
						<td style="text-align:left;vertical-align:center;">
							Gustavo Coelho
							<br>Software Engineer @ Hewlett Packard Enterprise
							<p style="font-size:20px">
								<br>Email: gcoelho@gcoelho.com
								<br>Twitter: @gafcoelho
								<br>GitHub: github.com/gcoelho
							</p>
						</td>
					</tr>
					<tr>
						<td style="text-align:right;vertical-align:center;">
							Luiz Svoboda
							<br>Software Engineer @ Hewlett Packard Enterprise
							<p style="font-size:20px">
								<br>Email: luizek@gmail.com
								<br>Twitter: @luizsvoboda
								<br>GitHub: github.com/lhsvobodaj
							</p>
						</td>
					</tr>
				</table>
			</section>
		</div>
	</div>

	<script src="lib/js/head.min.js"></script>
	<script src="js/reveal.js"></script>

	<script>
		// More info about config & dependencies:
		// - https://github.com/hakimel/reveal.js#configuration
		// - https://github.com/hakimel/reveal.js#dependencies
		Reveal.initialize({
			dependencies: [
				{ src: 'plugin/markdown/marked.js' },
				{ src: 'plugin/markdown/markdown.js' },
				{ src: 'plugin/notes/notes.js', async: true },
				{ src: 'plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } }
			]
		});
	</script>

	<style type="text/css">
		#header-left {
			position: absolute;
			top: 5%;
			left: 3%;
			width: 90%;
		}

		#footer-left {
			position: absolute;
			bottom: 3%;
			left: 3%;
		}
	</style>

	<!-- 2. Create hidden header/footer <div> -->
	<div id="hidden" style="display:none;">
		<div id="header">
			<div id="header-left" style="border-bottom:2px solid rgb(1,169,130);"></div>
			<div id="footer-left">
				<img style="width: 100px" src="css/theme/images/hpe-logo.png">
			</div>
		</div>
	</div>

	<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
	<script type="text/javascript">
		// 3. On Reveal.js ready event, copy header/footer <div> into each `.slide-background` <div>
		var header = $('#header').html();
		if (window.location.search.match(/print-pdf/gi)) {
			Reveal.addEventListener('ready', function (event) {
				$('.slide-background').append(header);
			});
		}
		else {
			$('div.reveal').append(header);
		}
	</script>

</body>

</html>